
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Agentic Skills Malware Detection Engine">
      
      
      
        <link rel="canonical" href="https://ap6pack.github.io/malwar/development/architecture/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../contributing/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Architecture - Malwar</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#malwar-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Malwar" class="md-header__button md-logo" aria-label="Malwar" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Malwar
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Ap6pack/malwar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Ap6pack/malwar
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Malwar" class="md-nav__button md-logo" aria-label="Malwar" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Malwar
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Ap6pack/malwar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Ap6pack/malwar
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/detection-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Detection Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../custom-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Rules (YAML DSL)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rule-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rule Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/threat-campaigns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Threat Campaigns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../crawl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ClawHub Crawling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diff-scanning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diff Scanning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rich TUI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/accuracy-report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accuracy Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugin System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML Scoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dashboard Analytics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scheduled-scanning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scheduled Scanning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../audit-logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audit Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rbac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching (Redis)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangChain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/github-action/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Action
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ci-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI/CD Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/stix-taxii/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STIX/TAXII Export
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/campaign-ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Campaign Ingestion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker & Compose
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes & Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Architecture Diagram
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entry-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entry Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skillmd-parser" class="md-nav__link">
    <span class="md-ellipsis">
      
        SKILL.md Parser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scancontext" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScanContext
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-4-layer-detection-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 4-Layer Detection Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The 4-Layer Detection Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Orchestration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-1-rule-engine-order10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 1: Rule Engine (order=10)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-url-crawler-order20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 2: URL Crawler (order=20)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-3-llm-analyzer-order30" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 3: LLM Analyzer (order=30)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-4-threat-intelligence-order40" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 4: Threat Intelligence (order=40)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoring-and-verdict-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoring and Verdict System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scoring and Verdict System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risk-score-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Risk Score Calculation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verdict-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verdict Mapping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overall-severity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overall Severity
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Layer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notification System
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Formats
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmarks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-architecture-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Architecture Diagram
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entry-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entry Points
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skillmd-parser" class="md-nav__link">
    <span class="md-ellipsis">
      
        SKILL.md Parser
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scancontext" class="md-nav__link">
    <span class="md-ellipsis">
      
        ScanContext
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-4-layer-detection-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 4-Layer Detection Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The 4-Layer Detection Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pipeline Orchestration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-1-rule-engine-order10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 1: Rule Engine (order=10)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-2-url-crawler-order20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 2: URL Crawler (order=20)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-3-llm-analyzer-order30" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 3: LLM Analyzer (order=30)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-4-threat-intelligence-order40" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer 4: Threat Intelligence (order=40)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoring-and-verdict-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoring and Verdict System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scoring and Verdict System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#risk-score-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Risk Score Calculation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verdict-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verdict Mapping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overall-severity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overall Severity
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Layer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notification System
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Formats
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<!-- Copyright (c) 2026 Veritas Aequitas Holdings LLC. All rights reserved. -->

<h1 id="malwar-architecture">malwar Architecture<a class="headerlink" href="#malwar-architecture" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>malwar is a 4-layer malware detection engine purpose-built for scanning agentic skills -- specifically SKILL.md files used in the OpenClaw/ClawHub ecosystem. Unlike traditional malware scanners that analyze binary executables or source code, malwar detects threats embedded in natural language markdown instructions that direct AI agents to perform malicious actions.</p>
<p>The threat landscape is significant: approximately 20% of ClawHub's 10,700+ published skills are confirmed malicious. The ClawHavoc campaign alone accounts for 824+ malicious skills delivering the AMOS infostealer. Existing security tools (VirusTotal, Cisco Skill Scanner, SecureClaw, Snyk ToxicSkills) all fail at natural language threat detection because attacks are markdown instructions, not code.</p>
<h2 id="system-architecture-diagram">System Architecture Diagram<a class="headerlink" href="#system-architecture-diagram" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>                    +------------------+
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>                    |   Entry Points   |
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>                    +------------------+
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                    |  CLI  |   API    |
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>                    | typer | FastAPI  |
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>                    +---+-------+------+
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>                        |       |
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>                        v       v
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>              +--------------------------+
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>              |     SKILL.md Parser      |
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>              | (frontmatter + markdown) |
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>              +------------+-------------+
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>                           |
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>                           v
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>              +---------------------------+
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>              |     Scan Pipeline          |
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>              |    (ScanPipeline)          |
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>              +---------------------------+
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>              |                           |
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>              |  +---------------------+  |
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>              |  |  Layer 1 (order=10) |  |
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>              |  |   Rule Engine       |  |
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>              |  | Pattern matching    |  |
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>              |  +--------+------------+  |
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>              |           |               |
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>              |           v               |
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>              |  +---------------------+  |
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>              |  |  Layer 2 (order=20) |  |
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>              |  |   URL Crawler       |  |
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>              |  | Fetch &amp; analyze URLs|  |
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>              |  +--------+------------+  |
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>              |           |               |
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>              |           v               |
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>              |  +---------------------+  |
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>              |  |  Layer 3 (order=30) |  |
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>              |  |   LLM Analyzer      |  |
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>              |  | Semantic analysis   |  |
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>              |  +--------+------------+  |
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>              |           |               |
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>              |           v               |
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>              |  +---------------------+  |
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>              |  |  Layer 4 (order=40) |  |
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>              |  |   Threat Intel      |  |
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>              |  | IOC correlation     |  |
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>              |  +--------+------------+  |
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>              |           |               |
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>              +---------------------------+
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>                          |
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>                          v
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>              +---------------------------+
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>              |       ScanResult          |
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>              | verdict / risk_score /    |
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>              | findings / severity       |
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>              +---------------------------+
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>                    |           |
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>                    v           v
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>              +---------+  +---------+
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>              | SQLite  |  | Output  |
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>              |   DB    |  | Console |
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>              |         |  | JSON    |
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>              |         |  | SARIF   |
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>              +---------+  +---------+
</code></pre></div>
<h2 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h2>
<h3 id="entry-points">Entry Points<a class="headerlink" href="#entry-points" title="Permanent link">&para;</a></h3>
<p>malwar provides two interfaces for users:</p>
<ol>
<li>
<p><strong>CLI</strong> (<code>malwar.cli.app</code>) -- A Typer-based command-line interface for scanning files, managing the database, listing signatures, and starting the API server.</p>
</li>
<li>
<p><strong>REST API</strong> (<code>malwar.api.app</code>) -- A FastAPI web server with endpoints for scanning, retrieving results, managing threat signatures, viewing campaigns, and generating reports. Includes a React frontend served from <code>web/dist/</code> in production mode.</p>
</li>
</ol>
<h3 id="skillmd-parser">SKILL.md Parser<a class="headerlink" href="#skillmd-parser" title="Permanent link">&para;</a></h3>
<p>The parser (<code>malwar.parsers.skill_parser</code>) transforms raw SKILL.md content into a structured <code>SkillContent</code> object:</p>
<ol>
<li>
<p><strong>Frontmatter Extraction</strong> -- Uses the <code>python-frontmatter</code> library to parse YAML frontmatter into <code>SkillMetadata</code> (name, author, description, tags, tools, source_url, author_url, version, icon).</p>
</li>
<li>
<p><strong>Markdown Body Parsing</strong> (<code>malwar.parsers.markdown_parser</code>) -- Extracts:</p>
</li>
<li><strong>URLs</strong> -- Both markdown links <code>[text](url)</code> and bare <code>https://</code> URLs</li>
<li><strong>Code Blocks</strong> -- Fenced code blocks with language, content, and line numbers</li>
<li>
<p><strong>Sections</strong> -- Heading-delimited sections with level, content, and line ranges</p>
</li>
<li>
<p><strong>Content Hashing</strong> -- Computes SHA-256 hash of the raw content for deduplication and tracking.</p>
</li>
</ol>
<h3 id="scancontext">ScanContext<a class="headerlink" href="#scancontext" title="Permanent link">&para;</a></h3>
<p>The <code>ScanContext</code> dataclass (<code>malwar.scanner.context</code>) is the mutable state object that flows through the pipeline:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ScanContext
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  +-- skill: SkillContent           # Parsed skill content
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  +-- scan_id: str                  # Unique scan identifier
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  +-- findings: list[Finding]       # Accumulated findings from all layers
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>  +-- url_analysis_results: dict    # URL crawler enrichment data
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>  +-- llm_analysis: dict            # LLM analyzer enrichment data
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  +-- matched_campaigns: list[str]  # Campaigns matched by threat intel
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  +-- errors: list[str]             # Non-fatal errors from any layer
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>  +-- metadata: dict                # Arbitrary enrichment metadata
</code></pre></div>
<p>Each layer reads the context to access previous layers' findings and enrichments, then adds its own findings to the shared list via <code>context.add_findings()</code>.</p>
<p>The context also computes a running <code>current_risk_score</code> property used for cost-control decisions (e.g., skipping expensive LLM analysis when early layers found nothing suspicious).</p>
<h2 id="the-4-layer-detection-pipeline">The 4-Layer Detection Pipeline<a class="headerlink" href="#the-4-layer-detection-pipeline" title="Permanent link">&para;</a></h2>
<h3 id="pipeline-orchestration">Pipeline Orchestration<a class="headerlink" href="#pipeline-orchestration" title="Permanent link">&para;</a></h3>
<p>The <code>ScanPipeline</code> class (<code>malwar.scanner.pipeline</code>) orchestrates the 4 detection layers sequentially. Detectors are registered with the pipeline and sorted by their <code>order</code> property.</p>
<p><strong>Execution flow:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>1. Create ScanContext with parsed SkillContent
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>2. Create ScanResult (status=RUNNING)
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>3. For each registered detector (sorted by order):
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>   a. Check if layer is in the allowed layers list
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>   b. Check cost-control skip conditions
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>   c. Run detector.detect(context) -&gt; list[Finding]
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>   d. Add findings to context
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>   e. Record layer in result.layers_executed
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>4. Compute final risk_score, verdict, severity
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>5. Return ScanResult (status=COMPLETED)
</code></pre></div>
<p><strong>Layer selection:</strong> The <code>layers</code> parameter allows callers to specify which layers to run. If omitted, all registered layers execute.</p>
<p><strong>Error isolation:</strong> If a detector raises an exception, the error is logged and recorded in <code>context.errors</code> and <code>result.errors</code>, but the pipeline continues to the next layer.</p>
<h3 id="layer-1-rule-engine-order10">Layer 1: Rule Engine (order=10)<a class="headerlink" href="#layer-1-rule-engine-order10" title="Permanent link">&para;</a></h3>
<p><strong>Module:</strong> <code>malwar.detectors.rule_engine</code></p>
<p>The rule engine performs fast, deterministic pattern matching against the skill content. It is always the first layer to run and produces the initial risk signal.</p>
<p><strong>Architecture:</strong></p>
<ul>
<li><code>BaseRule</code> -- Abstract base class defining the rule interface (<code>check(skill) -&gt; list[Finding]</code>)</li>
<li><code>RuleRegistry</code> -- Central registry using a <code>@rule</code> decorator for auto-registration</li>
<li><code>RuleEngineDetector</code> -- The <code>BaseDetector</code> implementation that iterates all enabled rules</li>
</ul>
<p><strong>Rule categories:</strong></p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Rules</th>
<th>What it Detects</th>
</tr>
</thead>
<tbody>
<tr>
<td>Obfuscation</td>
<td>MALWAR-OBF-001 to OBF-003</td>
<td>Base64 commands, hex payloads, raw IP in commands</td>
</tr>
<tr>
<td>Prompt Injection</td>
<td>MALWAR-PI-001 to PI-003</td>
<td>Instruction overrides, Unicode smuggling, hidden HTML comments</td>
</tr>
<tr>
<td>Credential Exposure</td>
<td>MALWAR-CRED-001 to CRED-002</td>
<td>Hardcoded secrets, credential harvesting instructions</td>
</tr>
<tr>
<td>Data Exfiltration</td>
<td>MALWAR-EXFIL-001 to EXFIL-003</td>
<td>Agent memory access, curl POST exfil, crypto wallet access</td>
</tr>
<tr>
<td>Known Malware</td>
<td>MALWAR-MAL-001</td>
<td>ClawHavoc C2 IPs, domains, repos, known authors</td>
</tr>
<tr>
<td>Social Engineering</td>
<td>MALWAR-SE-001 to SE-003</td>
<td>ClickFix fake prerequisites, suspicious downloads, typosquatting</td>
</tr>
<tr>
<td>Suspicious Commands</td>
<td>MALWAR-CMD-001 to CMD-004</td>
<td>Piped execution, npx -y, password archives, download-and-execute</td>
</tr>
</tbody>
</table>
<h3 id="layer-2-url-crawler-order20">Layer 2: URL Crawler (order=20)<a class="headerlink" href="#layer-2-url-crawler-order20" title="Permanent link">&para;</a></h3>
<p><strong>Module:</strong> <code>malwar.detectors.url_crawler</code></p>
<p>The URL crawler extracts, evaluates, fetches, and analyzes all URLs found in the skill content. It operates in 5 steps:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Step 1: Extract URLs
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  |  (extractor.py: markdown links, bare URLs, frontmatter URLs, code blocks)
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  v
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Step 2: Check Domain Reputation
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  |  (reputation.py: known-malicious=0.0, IP=0.2, paste-site=0.3, safe=1.0, unknown=0.5)
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  v
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>Step 3: Fetch Suspicious URLs (reputation &lt;= 0.6)
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  |  (fetcher.py: HEAD pre-check, concurrent GET with safety bounds)
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>  v
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>Step 4: Analyze Fetched Content
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>  |  (analyzer.py: redirect chains, content-type mismatch, shell/PS scripts, binaries, malware patterns)
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>  v
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>Step 5: Store Enrichment in Context
</code></pre></div>
<p><strong>Safety bounds:</strong> The <code>SafeFetcher</code> class enforces configurable limits:
- Maximum URLs per batch (default: 10)
- Per-request timeout (default: 5s)
- Maximum redirects (default: 3)
- Maximum response body size (default: 1 MB)
- Concurrency limit (default: 5)</p>
<p><strong>Known-safe domains</strong> are never fetched (score=1.0): github.com, docs.python.org, pypi.org, npmjs.com, developer.mozilla.org, stackoverflow.com, wikipedia.org, docs.anthropic.com, openai.com, google.com.</p>
<h3 id="layer-3-llm-analyzer-order30">Layer 3: LLM Analyzer (order=30)<a class="headerlink" href="#layer-3-llm-analyzer-order30" title="Permanent link">&para;</a></h3>
<p><strong>Module:</strong> <code>malwar.detectors.llm_analyzer</code></p>
<p>The LLM analyzer sends the full skill content to Claude (via the Anthropic API) for semantic threat analysis. This layer detects attacks that rules cannot catch -- social engineering, deceptive intent, and sophisticated prompt injection.</p>
<p><strong>Cost control:</strong> The LLM layer is skipped when the current risk score from earlier layers is below the <code>llm_skip_below_risk</code> threshold (default: 15). This means benign-looking skills avoid the API call entirely.</p>
<p><strong>Prompt structure:</strong></p>
<ol>
<li>
<p><strong>System prompt</strong> -- Instructs Claude to act as a cybersecurity analyst. Includes critical anti-prompt-injection safeguards telling Claude to treat all skill content as data, never as instructions.</p>
</li>
<li>
<p><strong>User prompt</strong> -- Contains:</p>
</li>
<li>Skill metadata (name, author, tags, tools)</li>
<li>Summary of prior findings from layers 1 and 2</li>
<li>
<p>Full SKILL.md content</p>
</li>
<li>
<p><strong>Response format</strong> -- Structured JSON with <code>threat_assessment</code>, <code>confidence</code>, <code>findings[]</code>, and <code>summary</code>.</p>
</li>
</ol>
<p><strong>Response parsing</strong> (<code>parser.py</code>):
- Handles raw JSON, JSON in markdown fences, trailing text
- Maps LLM categories to <code>ThreatCategory</code> enum values
- Maps LLM severity strings to <code>Severity</code> enum values
- Resolves <code>line_hint</code> strings to actual line numbers in the source</p>
<h3 id="layer-4-threat-intelligence-order40">Layer 4: Threat Intelligence (order=40)<a class="headerlink" href="#layer-4-threat-intelligence-order40" title="Permanent link">&para;</a></h3>
<p><strong>Module:</strong> <code>malwar.detectors.threat_intel</code></p>
<p>The threat intelligence layer correlates IOCs (Indicators of Compromise) extracted from all previous layers against a known threat signature database.</p>
<p><strong>IOC extraction sources:</strong>
- <code>ioc_values</code> and <code>evidence</code> from all prior findings
- Skill metadata: author, source_url, author_url
- Extracted URLs from the skill
- Full raw content (for substring matching)</p>
<p><strong>Signature matching:</strong>
- <strong>Exact match</strong> -- Substring search of the pattern value in any IOC
- <strong>Regex match</strong> -- Compiled regex pattern searched across all IOCs</p>
<p><strong>Campaign attribution:</strong> When a signature matches, the associated campaign is recorded in <code>context.matched_campaigns</code>. This enables campaign-level tracking and reporting.</p>
<p><strong>Hardcoded fallback signatures:</strong> When no database signatures are available, the matcher falls back to hardcoded ClawHavoc signatures (C2 IP, Glot snippet, payload domain, known author).</p>
<h2 id="scoring-and-verdict-system">Scoring and Verdict System<a class="headerlink" href="#scoring-and-verdict-system" title="Permanent link">&para;</a></h2>
<h3 id="risk-score-calculation">Risk Score Calculation<a class="headerlink" href="#risk-score-calculation" title="Permanent link">&para;</a></h3>
<p>Risk score is computed as a weighted sum of all findings, capped at 100:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>risk_score = min(100, sum(SEVERITY_WEIGHT[f.severity] * f.confidence for f in findings))
</code></pre></div>
<p><strong>Severity weights:</strong></p>
<table>
<thead>
<tr>
<th>Severity</th>
<th>Weight</th>
</tr>
</thead>
<tbody>
<tr>
<td>CRITICAL</td>
<td>100</td>
</tr>
<tr>
<td>HIGH</td>
<td>75</td>
</tr>
<tr>
<td>MEDIUM</td>
<td>50</td>
</tr>
<tr>
<td>LOW</td>
<td>25</td>
</tr>
<tr>
<td>INFO</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>A single CRITICAL finding with confidence 0.95 produces a risk score of 95. A single HIGH finding with confidence 0.85 produces 63.</p>
<h3 id="verdict-mapping">Verdict Mapping<a class="headerlink" href="#verdict-mapping" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Risk Score Range</th>
<th>Verdict</th>
</tr>
</thead>
<tbody>
<tr>
<td>75 -- 100</td>
<td>MALICIOUS</td>
</tr>
<tr>
<td>40 -- 74</td>
<td>SUSPICIOUS</td>
</tr>
<tr>
<td>15 -- 39</td>
<td>CAUTION</td>
</tr>
<tr>
<td>0 -- 14</td>
<td>CLEAN</td>
</tr>
</tbody>
</table>
<h3 id="overall-severity">Overall Severity<a class="headerlink" href="#overall-severity" title="Permanent link">&para;</a></h3>
<p>The <code>overall_severity</code> of a scan is the highest severity among all findings. If no findings exist, it defaults to <code>info</code>.</p>
<h2 id="data-flow">Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>SKILL.md file/content
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>        |
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        v
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  parse_skill_content() / parse_skill_file()
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        |
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        v
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>  SkillContent (metadata + body + code_blocks + URLs + sections + SHA-256)
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        |
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        v
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>  ScanPipeline.scan(skill, layers)
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        |
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        +---&gt; ScanContext created
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        |
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        +---&gt; Layer 1: RuleEngine  --&gt; findings added to context
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>        |
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        +---&gt; Layer 2: URLCrawler  --&gt; findings + url_analysis_results added
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        |
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        +---&gt; Layer 3: LLMAnalyzer --&gt; findings + llm_analysis added
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        |                              (skipped if risk &lt; threshold)
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        |
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        +---&gt; Layer 4: ThreatIntel --&gt; findings + matched_campaigns added
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        |
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        v
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>  ScanResult
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>    +-- scan_id, target, status
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    +-- risk_score (computed property)
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>    +-- verdict (computed property: MALICIOUS/SUSPICIOUS/CAUTION/CLEAN)
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>    +-- overall_severity (computed property)
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    +-- findings[] (all findings from all layers)
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>    +-- layers_executed[]
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>    +-- errors[]
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    +-- duration_ms
</code></pre></div>
<h2 id="storage-layer">Storage Layer<a class="headerlink" href="#storage-layer" title="Permanent link">&para;</a></h2>
<p>malwar uses SQLite with WAL mode via <code>aiosqlite</code> for persistence.</p>
<p><strong>Database tables:</strong></p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scans</code></td>
<td>Scan results with verdict, risk score, timing</td>
</tr>
<tr>
<td><code>findings</code></td>
<td>Individual threat findings linked to scans (FK cascade)</td>
</tr>
<tr>
<td><code>signatures</code></td>
<td>Threat intelligence signatures for IOC matching</td>
</tr>
<tr>
<td><code>campaigns</code></td>
<td>Tracked malware campaigns with IOCs and attribution</td>
</tr>
<tr>
<td><code>publishers</code></td>
<td>Author/publisher reputation tracking</td>
</tr>
<tr>
<td><code>url_analysis</code></td>
<td>URL fetch results linked to scans</td>
</tr>
</tbody>
</table>
<p><strong>Indexes</strong> are created on scans (target, sha256, verdict, created_at) and findings (scan_id, rule_id, severity, category) for query performance.</p>
<p><strong>Migrations</strong> run automatically on database initialization using <code>CREATE TABLE IF NOT EXISTS</code> and <code>INSERT OR IGNORE</code> for idempotent schema and seed data creation.</p>
<h2 id="notification-system">Notification System<a class="headerlink" href="#notification-system" title="Permanent link">&para;</a></h2>
<p>The webhook notifier (<code>malwar.notifications.webhook</code>) dispatches JSON payloads to configured webhook URLs when a scan produces a MALICIOUS or SUSPICIOUS verdict. Webhooks are fire-and-forget: failures are logged but never block the scan pipeline.</p>
<p><strong>Webhook payload:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;scan_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;verdict&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MALICIOUS&quot;</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">&quot;risk_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">&quot;finding_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nt">&quot;skill_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Suspicious Tool&quot;</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nt">&quot;top_findings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">      </span><span class="nt">&quot;rule_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MALWAR-CMD-001&quot;</span><span class="p">,</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Remote script piped to shell&quot;</span><span class="p">,</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">      </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;critical&quot;</span><span class="p">,</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">      </span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.92</span><span class="p">,</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">      </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;suspicious_command&quot;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="p">}</span>
</code></pre></div></p>
<h2 id="frontend">Frontend<a class="headerlink" href="#frontend" title="Permanent link">&para;</a></h2>
<p>malwar includes a React + TypeScript frontend (in <code>web/</code>) built with Vite. In production, the compiled frontend assets are served by FastAPI from <code>web/dist/</code>. In development, the Vite dev server runs on port 3000 with CORS configured to proxy API calls to the FastAPI backend on port 8000.</p>
<h2 id="output-formats">Output Formats<a class="headerlink" href="#output-formats" title="Permanent link">&para;</a></h2>
<p>malwar supports three output formats for scan results:</p>
<ol>
<li>
<p><strong>Console</strong> -- Rich-formatted terminal output with color-coded severity, verdict banners, and finding details.</p>
</li>
<li>
<p><strong>JSON</strong> -- Full Pydantic model serialization of <code>ScanResult</code>.</p>
</li>
<li>
<p><strong>SARIF 2.1.0</strong> -- Static Analysis Results Interchange Format for integration with GitHub Code Scanning, VS Code, and other SARIF-compatible tools. Severity is mapped: CRITICAL/HIGH to <code>error</code>, MEDIUM to <code>warning</code>, LOW/INFO to <code>note</code>.</p>
</li>
</ol>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>All settings are managed via environment variables with the <code>MALWAR_</code> prefix, loaded from <code>.env</code> files using Pydantic Settings. Key configuration areas:</p>
<ul>
<li><strong>Database</strong> -- <code>MALWAR_DB_PATH</code></li>
<li><strong>API Server</strong> -- <code>MALWAR_API_HOST</code>, <code>MALWAR_API_PORT</code>, <code>MALWAR_API_WORKERS</code></li>
<li><strong>Authentication</strong> -- <code>MALWAR_API_KEYS</code> (comma-separated)</li>
<li><strong>LLM</strong> -- <code>MALWAR_ANTHROPIC_API_KEY</code>, <code>MALWAR_LLM_MODEL</code>, <code>MALWAR_LLM_SKIP_BELOW_RISK</code></li>
<li><strong>URL Crawler</strong> -- <code>MALWAR_CRAWLER_MAX_URLS</code>, <code>MALWAR_CRAWLER_TIMEOUT</code>, <code>MALWAR_CRAWLER_CONCURRENCY</code></li>
<li><strong>Rate Limiting</strong> -- <code>MALWAR_RATE_LIMIT_RPM</code></li>
<li><strong>Logging</strong> -- <code>MALWAR_LOG_LEVEL</code>, <code>MALWAR_LOG_FORMAT</code></li>
<li><strong>Webhooks</strong> -- <code>MALWAR_WEBHOOK_URLS</code> (comma-separated)</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Ap6pack/malwar" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>